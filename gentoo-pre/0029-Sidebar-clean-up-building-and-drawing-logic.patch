From 281344e9a718a251de334100e180cfc0a90c9b74 Mon Sep 17 00:00:00 2001
From: Kevin McCarthy <kevin@8t8.us>
Date: Sat, 4 Jun 2016 11:32:03 -0700
Subject: [PATCH 29/37] Sidebar clean up: building and drawing logic.

Fix the autoconf/makefile.am changes to be consistent.

Create a global SidebarNeedsRedraw to indicate a redraw is needed,
instead of putting sb_draw() everywhere in the code.

Create a menu_redraw_sidebar() function and use the REDRAW_SIDEBAR
flag instead of piggy-backing it inside the index loop.

Fix curs_main.c and pager.c to be a bit cleaner by using the global and
REDRAW_SIDEBAR.

Start to clean up some of the buffy code, but this needs to refactored
and fixed.
---
 addrbook.c | 2 +-
 globals.h  | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/addrbook.c b/addrbook.c
index 8ede157..df0a481 100644
--- a/addrbook.c
+++ b/addrbook.c
@@ -81,7 +81,7 @@ alias_format_str (char *dest, size_t destlen, size_t col, int cols, char op, con
 
 static void alias_entry (char *s, size_t slen, MUTTMENU *m, int num)
 {
-  mutt_FormatString (s, slen, 0, COLS - SidebarWidth, NONULL (AliasFmt), alias_format_str, (unsigned long) ((ALIAS **) m->data)[num], MUTT_FORMAT_ARROWCURSOR);
+  mutt_FormatString (s, slen, 0, MuttIndexWindow->cols, NONULL (AliasFmt), alias_format_str, (unsigned long) ((ALIAS **) m->data)[num], MUTT_FORMAT_ARROWCURSOR);
 }
 
 static int alias_tag (MUTTMENU *menu, int n, int m)
diff --git a/globals.h b/globals.h
index 336fa64..0b33e81 100644
--- a/globals.h
+++ b/globals.h
@@ -244,9 +244,9 @@ WHERE short ScoreThresholdDelete;
 WHERE short ScoreThresholdRead;
 WHERE short ScoreThresholdFlag;
 
-WHERE short SidebarWidth INITVAL(0);
 #ifdef USE_SIDEBAR
 WHERE short SidebarRefreshTime;
+WHERE short SidebarWidth INITVAL(0);
 WHERE LIST *SidebarWhitelist INITVAL(0);
 WHERE int SidebarNeedsRedraw INITVAL (0);
 #endif
-- 
2.9.0

