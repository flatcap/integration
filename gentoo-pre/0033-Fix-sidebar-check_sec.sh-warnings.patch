From 6668379a61dca07c9f8786f672a265b43622e8e4 Mon Sep 17 00:00:00 2001
From: Kevin McCarthy <kevin@8t8.us>
Date: Sat, 4 Jun 2016 11:32:04 -0700
Subject: [PATCH 33/45] Fix sidebar check_sec.sh warnings.

Use safe_malloc, FREE, and the safe_strcat functions.
---
 sidebar.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/sidebar.c b/sidebar.c
index 0782cdb..57b7209 100644
--- a/sidebar.c
+++ b/sidebar.c
@@ -750,11 +750,12 @@ static void draw_sidebar (int num_rows, int num_cols, int div_width)
       {
         if (option (OPTSIDEBARSHORTPATH))
           tmp_folder_name += lastsep;  /* basename */
-        sidebar_folder_name = malloc (strlen (tmp_folder_name) + sidebar_folder_depth*strlen (NONULL(SidebarIndentString)) + 1);
+        int sfn_len = strlen (tmp_folder_name) + sidebar_folder_depth*strlen (NONULL(SidebarIndentString)) + 1;
+        sidebar_folder_name = safe_malloc (sfn_len);
         sidebar_folder_name[0]=0;
         for (i=0; i < sidebar_folder_depth; i++)
-          strncat (sidebar_folder_name, NONULL(SidebarIndentString), strlen (NONULL(SidebarIndentString)));
-        strncat (sidebar_folder_name, tmp_folder_name, strlen (tmp_folder_name));
+          safe_strcat (sidebar_folder_name, sfn_len, NONULL(SidebarIndentString));
+        safe_strcat (sidebar_folder_name, sfn_len, tmp_folder_name);
       }
     }
 #ifdef USE_NOTMUCH
-- 
2.8.2

